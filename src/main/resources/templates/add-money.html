<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Add Money - Goldencat Bank</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <!-- Your existing CSS styles -->
</head>
<body>
<!-- Your existing navbar -->

<div class="container">
    <h2 class="text-center">Add Money to Account</h2>

    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="form-container">
                <form id="addMoneyForm">
                    <div class="form-group">
                        <label>Amount (₹):</label>
                        <input type="number" class="form-control" id="amount" min="1" max="50000" required />
                        <small class="form-text text-muted">Minimum: ₹1, Maximum: ₹50,000</small>
                    </div>
                    <button type="submit" class="btn btn-block btn-success">Add Money</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('addMoneyForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const amount = document.getElementById('amount').value;
        if (!amount || amount < 1) {
            alert('Please enter a valid amount');
            return;
        }

        // Create order
        fetch('/create-order', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'amount=' + amount
        })
        .then(response => response.json())
        .then(order => {
            const options = {
                key: '[[${razorpayKeyId}]]',
                amount: order.amount * 100,
                currency: 'INR',
                name: 'Ravi Bank Service',
                description: 'Add Money to Account',
                order_id: order.razorpayOrderId,
                handler: function(response) {
                    // Verify payment
                    fetch('/verify-payment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `razorpay_order_id=${response.razorpay_order_id}&razorpay_payment_id=${response.razorpay_payment_id}&razorpay_signature=${response.razorpay_signature}`
                    })
                    .then(response => response.text())
                    .then(result => {
                        if (result === 'success') {
                            alert('Payment successful! Money added to your account.');
                            window.location.href = '/dashboard';
                        } else {
                            alert('Payment verification failed. Please contact support.');
                        }
                    });
                },
                prefill: {
                    name: 'Your Name',
                    email: 'your.email@example.com',
                    contact: '9999999999'
                },
                theme: {
                    color: '#ffd700'
                }
            };

            const rzp = new Razorpay(options);
            rzp.open();
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to create payment order');
        });
    });
</script>
</body>
</html>